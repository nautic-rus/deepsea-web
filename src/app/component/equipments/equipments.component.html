<div class="all-page-equip">
  <div class="min-height-card">
    <div class="empty-card"></div>
    <div class="card-head df sticky-card">
      <div [class.button-disabled]="createEqButtonAreHidden" class="eq-button blue-button cxy mr-10" (click)="newEquipment()">
        <div class="pr-10 cxy">
          <img src="assets/icons/plus3.svg" height="18">
        </div>
        <div   class="cxy">{{t.tr('Добавить оборудование')}}</div>
      </div>
      <div class="mr-10">
        <p-multiSelect styleClass="width-200" [options]="projects" [(ngModel)]="selectedProjects" (ngModelChange)="projectChanged()" optionLabel="name" optionValue="name"></p-multiSelect>
      </div>
      <div class="mr-10">
        <p-multiSelect styleClass="width-200" [options]="departments" [(ngModel)]="selectedDepartments" (ngModelChange)="departmentChanged()" optionLabel="label" optionValue="value"></p-multiSelect>
      </div>
      <div class="p-ml-auto mr-10 df">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input #search pInputText type="text" (input)="dt.filterGlobal(search.value, 'contains')" [placeholder]="'Поиск по SFI'" class="border width-200" />
      </span>
      </div>
    </div>

    <div class="empty-card-bottom"></div>
    <div class="card-overflow ovf-auto">
      <p-table #dt
               id="dt"
               styleClass="p-datatable-striped"
               [globalFilterFields]="['sfi','name']"
               scrollHeight="calc(100vh - 220px)"
               [scrollable]="true"
               class="" [value]="equipments" dataKey="name" pRowToggler >
        <ng-template pTemplate="header">
          <tr>
            <th></th>
            <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
            <th pSortableColumn="sfi">Group <p-sortIcon field="sfi"></p-sortIcon></th>
            <th pSortableColumn="status">Status<p-sortIcon field="status"></p-sortIcon></th>
            <th class="df" pSortableColumn="department">Department<p-sortIcon field="department"></p-sortIcon></th>
            <th pSortableColumn="comment">Comment<p-sortIcon field="comment"></p-sortIcon></th>
            <th pSortableColumn="respons_surname">Responsible<p-sortIcon field="respons_surname"></p-sortIcon></th>
            <th pSortableColumn="itt">ITT <p-sortIcon field="itt"></p-sortIcon></th>
            <th></th>
          </tr>
        </ng-template>

        <!--      заполняем таблицу с оборудованием-->
        <ng-template pTemplate="body" let-eq let-expanded="expanded">
          <tr class="equipment-tr task-row cursor-pointer">
            <td>
              <button type="button" pButton pRipple [pRowToggler]="eq" class="p-button-text p-button-rounded p-button-plain" [disabled]="showSuppliersButtonIsDisabled(eq)" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
            </td>
            <td (click)="editEquipment(eq)">{{ eq.id }}</td>
            <td (click)="editEquipment(eq)">SFI {{ eq.sfi }}-{{ eq.name }}</td>
            <td [innerHTML]="issueManager.localeStatus(eq.status) | safeHtml" (click)="editEquipment(eq)">{{ eq.status }}</td>
            <td (click)="editEquipment(eq)" >{{ eq.department }}</td>
            <td (click)="editEquipment(eq)" [innerHTML]="issueManager.trim(eq.comment)"></td>
            <td (click)="editEquipment(eq)">{{ eq.respons_name }} {{ eq.respons_surname }}</td>
            <td (click)="editEquipment(eq)">{{ eq.itt ===1? 'YES' : 'NO' }}</td>
            <td><div [class.button-disabled]="createSuppButtonAreHidden"  tabindex="10" (click)="addSupplier(eq)" class="button-add-sup cxy green-button">{{t.tr('Добавить поставщика')}}</div></td>
          </tr>
        </ng-template>

        <!--     выпадающий список suppliers-->
        <ng-template pTemplate="rowexpansion" let-eq>
          <tr *ngIf="!showSuppliersButtonIsDisabled(eq)">
            <p-table class="w-100 padding-10 border margin-10"  [value]="eq.suppliers" dataKey="equipm_id">
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="id">ID<p-sortIcon field="id"></p-sortIcon></th>
                  <th pSortableColumn="name">Supplier<p-sortIcon field="name"></p-sortIcon></th>
                  <th pSortableColumn="status">Status<p-sortIcon field="status"></p-sortIcon></th>
                  <th pSortableColumn="last_update">Last update<p-sortIcon field="last_update"></p-sortIcon></th>
                </tr>
              </ng-template>
              <ng-template class="addTable" pTemplate="body" let-supplier>
                <tr class="task-row cursor-pointer">
                  <td (click)="editSupplier(eq, supplier)">{{ supplier.id }}</td>
                  <td (click)="editSupplier(eq, supplier)">{{ supplier.name }}</td>
                  <td (click)="editSupplier(eq, supplier)" class="text-14">
                    <span [innerHTML]="issueManager.localeStatus(supplier.status) | safeHtml"></span>
                  </td>
                  <td (click)="editSupplier(eq, supplier)">{{getDateOnly(supplier.last_update)}}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td>There are no suppliers for this equipment yet</td>
                </tr>
              </ng-template>
            </p-table>
            </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>




















