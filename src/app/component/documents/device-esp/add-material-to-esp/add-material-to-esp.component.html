<div class="w-100 dialog df">
  <div class="w-100 df">
    <div class="w-15">
      <div class="menu-card">
        <p-tree class="tree" [value]="nodes" selectionMode="single" [(selection)]="selectedNode" (selectionChange)="selectNode()">
          <ng-template let-node pTemplate="default">
            <div class="df">
              <div>{{node.label}}</div>
              <div class="mini-notes cxy">{{node.count}}</div>
            </div>
          </ng-template>
        </p-tree>
      </div>
    </div>
    <div class="w-85">
      <span class="p-input-icon-left p-ml-auto">
        <i class="pi pi-search"></i>
        <input pInputText type="text" [placeholder]="t.tr('Поиск...')" [(ngModel)]="search" (input)="table.filterGlobal(search, 'contains')"  class="border" />
      </span>
      <div class="cards">
        <p-table #table [value]="materials"
                 [scrollable]="true"
                 scrollHeight="calc(100vh - 226px)"
                 [virtualScroll]="true"
                 [virtualRowHeight]="40"
                 [reorderableColumns]="false"
                 [resizableColumns]="false"
                 styleClass="p-datatable-striped"
                 [globalFilterFields]="['name','description','singleWeight','provider','note','code']">
          <ng-template pTemplate="header">
            <tr class="df">
              <th pSortableColumn="name" class="cxy min-width-220 w-27">{{t.tr('Наименование')}}
                <p-sortIcon field="name"></p-sortIcon>
              </th>
              <th pSortableColumn="description" class="cxy min-width-150 w-15">{{t.tr('Обозначение')}}
                <p-sortIcon field="description"></p-sortIcon>
              </th>
              <th pSortableColumn="kvz" class="cxy min-width-75 w-7">{{t.tr('КВЗ')}}
                <p-sortIcon field="kvz"></p-sortIcon>
              </th>
              <th pSortableColumn="coefficient" class="cxy min-width-75 w-7">{{t.tr('Коэф.')}}
                <p-sortIcon field="coefficient"></p-sortIcon>
              </th>
              <th pSortableColumn="weight" class="cxy min-width-75 w-7">{{t.tr('Вес кг')}}
                <p-sortIcon field="weight"></p-sortIcon>
              </th>
              <th pSortableColumn="code" class="cxy min-width-75 w-7">{{t.tr('КЕИ')}}
                <p-sortIcon field="code"></p-sortIcon>
              </th>
              <th pSortableColumn="provider" class="cxy min-width-190 w-10">{{t.tr('Поставщик')}}
                <p-sortIcon field="provider"></p-sortIcon>
              </th>
              <th pSortableColumn="notes" class="cxy min-width-190 w-10">{{t.tr('Примечания')}}
                <p-sortIcon field="notes"></p-sortIcon>
              </th>
              <th pSortableColumn="trm" class="cxy min-width-190 w-10">{{t.tr('TRM')}}
                <p-sortIcon field="trm"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-material let-i="rowIndex">
            <tr class="cursor-pointer row-table-doc-hover" [class.selected-material]="selectedMaterial == material" (click)="selectMaterial(material)">
              <td class="min-width-220 w-27 text-14">{{material.name}}</td>
              <td class="min-width-150 w-15 text-14">{{material.description}}</td>
              <td class="min-width-75 w-7 text-14">{{material.category}}</td>
              <td class="min-width-75 w-7 text-14">{{material.coefficient}}</td>
              <td class="min-width-75 w-7 text-14">{{material.singleWeight}}</td>
              <td class="min-width-75 w-7 text-14">{{material.units}}</td>
              <td class="min-width-190 w-10 text-14">{{material.provider}}</td>
              <td class="min-width-190 w-10 text-14">{{material.note}}</td>
              <td class="min-width-190 w-10 text-14">
                <div class="df">
                  <div class="trm-materials">
                    <span>{{material.code}}</span>
                  </div>
                  <div (click)="copyTrmCode(material.code, 't' + i)" class="trm-copy-materials cursor-pointer cxy position-relative">
                    <img src="assets/icons/trm-sup.svg" height="14">
                    <div class="copy-tooltip-trm" [hidden]="!showTooltip('t' + i)">Copied!</div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
    <div>
      SELECTED: {{selectedMaterial.name}}
      <div class="pt-30">
        LABEL<input type="text" pInputText [(ngModel)]="label"/>
        UNITS<p-dropdown [(ngModel)]="units" [options]="unitsAvailable" placeholder="" class="select" styleClass="width-200 border-material"></p-dropdown>
        COUNT<p-inputNumber [(ngModel)]="count" mode="decimal" [minFractionDigits]="2" class="width-200 " locale="en-US"></p-inputNumber>
      </div>
      <button (click)="close()">ОТМЕНА</button>
      <button [disabled]="selectedMaterial.name == ''" (click)="addMaterial()">ДОБАВИТЬ</button>
    </div>
  </div>
</div>
